<!DOCTYPE html>
<html>

<head>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113535243-4"></script>
	<script>
		var useCookies = (localStorage.getItem('useCookies') === 'true');
		if (useCookies) {
			window.dataLayer = window.dataLayer || [];
			function gtag () {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());
			gtag('config', 'UA-113535243-4', { 'anonymize_ip': true });
		}
	</script>

	

	<!-- Meta -->
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<meta name="generator" content="Jekyll">

	<title>Building blocks</title>
  <meta name="description" content="The major building blocks of the `c64lib`.">

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/docu/css/main.css">

	<!-- RSS -->
	<link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="img/favicon.png">

</head>


<body>
	<div id="wrap">

	  	<!-- Navigation -->
	  	<nav id="nav">
	<div id="nav-list">
		<a href="/docu/">Home</a>

		<!-- Nav pages -->
		
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	  
	    
	      <a href="/docu/about" title="About">About</a>
	    
	  
	    
	      <a href="/docu/install" title="Installation guide">Install</a>
	    
	  
	    
	      <a href="/docu/news/" title="News">News</a>
	    
	  
	    
	      <a href="/docu/contribute" title="Contribute">Contribute</a>
	    
	  
	    
	      <a href="/docu/privacy" title="Privacy">Privacy</a>
	    
	  

    <!-- Nav links -->
	  <a href="https://github.com/c64lib">Github</a>


	</div>

  <!-- Nav footer -->
	
	  <footer>

</footer>

	

</nav>


    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>

      <!-- Header -->
      
        <header id="header" class="parent justify-spaceBetween">
  <div class="inner w100 relative">
    <span class="f-left">
      <a href="/docu/">
          <h1><code>c64lib</code></h1>
      </a>
    </span>
    <span id="nav-links" class="absolute right bottom">
      <!-- Nav pages -->
      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	    
	      
	        <a href="/docu/about" title="About">About</a>
	      
	    
	      
	        <a href="/docu/install" title="Installation guide">Install</a>
	      
	    
	      
	        <a href="/docu/news/" title="News">News</a>
	      
	    
	      
	        <a href="/docu/contribute" title="Contribute">Contribute</a>
	      
	    
	      
	        <a href="/docu/privacy" title="Privacy">Privacy</a>
	      
	    

      <!-- Nav links -->
	    <a href="https://github.com/c64lib">Github</a>


    </span>
  </div>
</header>




      

    <!-- Main content -->
	  <div id="container">

		<main>

			<article id="page">
  <h1>Building blocks</h1>
  <p>There are plenty of elements that can be declared within library and then
reused. In most cases a dedicated Kick Assembler syntactic elements are used.
These elements are declared source files (<code class="highlighter-rouge">asm</code>) which can be used by your
programs by using <code class="highlighter-rouge">#import</code> directive.</p>

<p>Most of the library source files have
<code class="highlighter-rouge">#importonce</code> flag set - that is given library file can be imported in many
places (in direct or indirect way) and only first import is effective. That also
means that libraries can import themselves (and in fact they do!).</p>

<p>This document describes all kinds of elements that are declared by <code class="highlighter-rouge">c64lib</code>.</p>

<h2 id="namespace">Namespace</h2>
<p>All elements of <code class="highlighter-rouge">c64lib</code> are defined within <code class="highlighter-rouge">c64lib</code> namespace, that is,
they are visible only inside this namespace. This approach prevents possible
name clashes between possible other libraries that could be used together
with <code class="highlighter-rouge">c64lib</code> in a project.</p>

<h2 id="label">Label</h2>
<p>A label is a value tagged with name. Labels are used to give symbolic names
to values denoting addresses, registers or constants.
Labels are useful to define memory locations and are widely used in <a href="https://github.com/c64lib/chipset">chipset</a> 
library:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.label VIC2                 = $D000 
.label SPRITE_0_X           = VIC2 + $00 
.label SPRITE_0_Y           = VIC2 + $01 
.label SPRITE_1_X           = VIC2 + $02 
.label SPRITE_1_Y           = VIC2 + $03 
.label SPRITE_2_X           = VIC2 + $04 
.label SPRITE_2_Y           = VIC2 + $05 
</code></pre></div></div>

<p>Labels are always declared inside <code class="highlighter-rouge">c64lib</code> namespace.
Labels can be reached outside <code class="highlighter-rouge">c64lib</code> namespace by prefixing their names with
namespace name (labels are the only elements that can be accessed that way due
to Kick Assembler limitations). For example: at any time it is legal to write:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lda #100
sta c64lib.SPRITE_0_X
</code></pre></div></div>

<h2 id="function">Function</h2>
<p>A function is an element of Kick Assembler that is declared using
<code class="highlighter-rouge">.function</code> keyword. Functions does not assemble into any machine code -
they are used by assembler to evaluate values that can be then used 
in other functions, macros or to assembly a code.</p>

<p>Example of function that negates (inverts all bits) of its argument:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.function neg(value) {
  .return value ^ $FF
}
</code></pre></div></div>

<p>Example of function that calculates packed value of memory register based 
on its arguments:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/*
 * Params:
 * video: location of video ram: 0..15
 * bitmap: location of bitmap definition: 0..1
 */
.function getBitmapMemory(video, bitmap) {
  .return bitmap&lt;&lt;3 | video&lt;&lt;4
}
</code></pre></div></div>

<p>Functions are always declared inside <code class="highlighter-rouge">c64lib</code> namespace.</p>

<h2 id="macro">Macro</h2>
<p>A macro is an element of Kick Assembler that is declared using <code class="highlighter-rouge">.macro</code>
directive. Once used, macro is replaced with assembly code defining it.
Macros can be parametrised (that is, they can take an argument, or even
more arguments) - this parametrisation can affect the code being
generated.</p>

<p>It is noteworthy that macro is not an equivalent of subroutine, 
even though it looks similar to one from syntactic point of view. 
When macro is “called”:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>someFancyMacro(parameter1, parameter2)
</code></pre></div></div>

<p>it does not mean, that your code will jump into place where macro 
<code class="highlighter-rouge">someFancyMacro</code> is declared, pass both parameters and return from that 
place once execution is finished. Instead, an assembler will paste
code declared inside macro substituting parameters with values provided
as <code class="highlighter-rouge">parameter1</code> and <code class="highlighter-rouge">parameter2</code>.</p>

<p>Under some circumstances you can use macros as subroutines. This may
be fast, because there is no subroutine calling overhead. This will
however consume a lot of memory (in sense of generated machine code)
if not used wisely.</p>

<h2 id="subroutine">Subroutine</h2>
<p>As subroutine we understand a piece of ML code that can be used by
jumping there with <code class="highlighter-rouge">jsr</code> operation. A subroutine always ends with
<code class="highlighter-rouge">rts</code> which means that at the end of execution program counter will
be restored to the position right after original <code class="highlighter-rouge">jsr</code> operation
and code execution will continue. In this sense a subroutine is
an equivalent of procedure, function or method in high level
programming languages.</p>

<p>Kick Assembler as such does not provide any</p>

<h2 id="macro-hosted-subroutine">Macro-hosted subroutine</h2>

<h2 id="global-importables">Global importables</h2>



</article>


	  </main>

		  <!-- Pagination links -->
      

	  </div>

	    <!-- Footer -->
	    <footer><span>&#169; 2018-2019 <code>c64lib</code> &#10540; last update: 2019-12-06 23:16</span></footer>


      <div id="gdpr" style="display: none;">
        <p>
          This web page uses cookies to track anonymous user activities. By continuing using this site
          or by closing this banner you indicate your consent to use these cookies.
          You can change settings, i.e. disable user tracking on <a href="privacy.html">privacy</a> page.
        </p>
        <button id="gdprClose">Close</button>
      </div>

	    <!-- Script -->
      <script src="/docu/js/main.js"></script>	


	</div>

</body>
</html>
